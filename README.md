# 🎹 Additive + FM Synthesizer

Rustで実装されたAdditive（加算合成）とFM（周波数変調）のマルチエンジンシンセサイザーです。**ポリフォニック対応**で複数の音を同時に演奏でき、**任意の時間指定**で精密な音の制御が可能です。

## ✨ 特徴

- **🎵 ポリフォニック**: 複数音同時再生対応
- **⏱️ 任意の時間指定**: 精密な持続時間制御（0.1秒単位）
- **🎛️ Additive Engine**: 64個の倍音を個別に制御可能
- **🎚️ FM Engine**: 6個のオペレーターで周波数変調
- **🔄 Engine Blender**: 両エンジンをクロスフェードでブレンド
- **📈 ADSR Envelope**: アタック、ディケイ、サステイン、リリース
- **🔊 Low-pass Filter**: カットオフとレゾナンス制御
- **🎧 リアルタイム音声出力**: cpalライブラリで低レイテンシー
- **🎮 インタラクティブ制御**: コマンドラインでのリアルタイム操作
- **🇯🇵 日本語インターフェース**: 分かりやすい操作説明

## 🚀 セットアップ

### 前提条件

- Rust 1.70以上
- Windows 10/11（現在のターゲット）
- Visual Studio Build Tools（C++ build tools）

### インストール

```bash
# リポジトリをクローン
git clone https://github.com/wTXTEYi8/synthesizer.git
cd synthesizer

# ビルド
cargo build

# 実行
cargo run
```

## 📁 プロジェクト構造

```
synthesizer/
├── src/
│   ├── main.rs      # メインエントリーポイント（インタラクティブ制御）
│   ├── engine.rs    # 合成エンジン（Additive + FM）
│   ├── synth.rs     # シンセサイザー本体（ポリフォニック対応）
│   └── audio.rs     # オーディオ出力（cpal統合）
├── Cargo.toml       # 依存関係
├── .gitignore       # Git除外設定
└── README.md        # このファイル
```

## 🎛️ 機能

### 🎵 ポリフォニック機能
- **複数音同時再生**: 最大64音同時再生可能
- **ボイス管理**: 個別の音声（Voice）管理システム
- **和音演奏**: C-E-Gなどの和音を簡単に作成
- **リアルタイム制御**: 音の開始・停止をリアルタイムで制御

### ⏱️ 任意の時間指定機能
- **精密な時間制御**: 0.1秒単位での持続時間指定
- **自動停止**: 指定時間後の自動停止
- **エラーハンドリング**: 無効な入力の適切な処理
- **複数形式対応**: 単音、和音の時間指定

### 🎛️ Additive Engine
- 64個の倍音を個別に制御
- 各倍音の振幅と有効/無効切り替え
- リアルタイム倍音編集

### 🎚️ FM Engine
- 6個のオペレーター
- 周波数比、振幅、フィードバック制御
- オペレーター間の変調

### 📈 エンベロープ
- Attack: 音の立ち上がり時間
- Decay: ピークからサステインレベルへの減衰時間
- Sustain: キーを押し続けている間の音量レベル
- Release: キーを離してからの減衰時間

### 🔊 フィルター
- ローパスフィルター
- カットオフ周波数制御
- レゾナンス（Q値）制御

### 🎧 オーディオ出力
- **cpal統合**: クロスプラットフォームオーディオ
- **低レイテンシー**: リアルタイム音声処理
- **マルチフォーマット対応**: F32, I16, U16サンプル形式

## 🎮 操作方法

### 基本操作
- **`n` + Enter**: 中央のC音 (60) を再生
- **`e` + Enter**: E音 (64) を再生
- **`g` + Enter**: G音 (67) を再生
- **`c` + Enter**: 高いC音 (72) を再生
- **`s` + Enter**: 全ての音を停止
- **`q` + Enter**: プログラム終了

### 音色調整
- **`1-9` + Enter**: ブレンド比率変更（1=Additive、9=FM）
- **`a` + Enter**: エンベロープ調整
- **`f` + Enter**: フィルター調整

### 状態確認
- **`p` + Enter**: 現在アクティブな音を表示

### ⏱️ 任意の時間指定
- **`C 2.5`**: 中央のC音を2.5秒間再生
- **`E 1.8`**: E音を1.8秒間再生
- **`G 0.3`**: G音を0.3秒間再生
- **`H 4.2`**: 高いC音を4.2秒間再生
- **`CHORD 5.0`**: C-E-G和音を5.0秒間再生

### 演奏例
```
> n    ← 中央のC音開始（継続再生）
> e    ← E音追加（C-Eの和音）
> g    ← G音追加（C-E-Gの和音）
> s    ← 全ての音を停止

> C 2.5    ← 中央のC音を2.5秒間再生
> E 1.8    ← E音を1.8秒間再生
> CHORD 5.0 ← C-E-G和音を5.0秒間再生
```

## 🔧 開発

### 現在の機能
- ✅ ポリフォニック音声出力
- ✅ 任意の時間指定機能
- ✅ リアルタイムインタラクティブ制御
- ✅ Additive + FM マルチエンジン
- ✅ ADSR エンベロープ
- ✅ ローパスフィルター
- ✅ クロスプラットフォームオーディオ
- ✅ 日本語インターフェース

### 今後の予定
1. **🎹 MIDI入力対応**: キーボードからの演奏
2. **🖥️ GUIインターフェース**: eguiでの視覚的制御
3. **🎛️ エフェクト**: リバーブ、ディレイ、コーラス
4. **💾 プリセット**: 音色保存・読み込み機能
5. **🎼 スコア再生**: MIDIファイル再生機能

## 📚 学習ポイント

このプロジェクトは以下の技術を学ぶのに適しています：

- **デジタル信号処理**: サンプリング、フィルタリング
- **音響合成**: 加算合成、周波数変調
- **ポリフォニック処理**: 複数音声の同時管理
- **時間制御**: 精密な持続時間管理
- **Rust言語**: トレイト、ジェネリクス、エラーハンドリング
- **リアルタイムシステム**: バッファリング、スレッド処理
- **オーディオプログラミング**: cpal、リアルタイム音声処理

## 🤝 貢献

プルリクエストやイシューの報告を歓迎します！

## 📄 ライセンス

MIT License

## 🙏 謝辞

このプロジェクトは、オーディオプログラミングとRust言語の学習を目的として作成されました。
