# 🎹 Rust シンセサイザー

Rustで実装されたAdditive（加算合成）とFM（周波数変調）を使用した豊かな音表現のリアルタイムシンセサイザーです。

## 🎵 機能

- **Additive Synthesis**: 64個の倍音による豊かで複雑な音色
- **FM Synthesis**: 6個のオペレーターによる動的で進化する音色
- **Engine Blending**: AdditiveとFMエンジン間のスムーズなクロスフェード
- **ADSR Envelope**: アタック、ディケイ、サステイン、リリース制御
- **Low-pass Filter**: カットオフとレゾナンス制御
- **Real-time Audio Output**: cpalクレートを使用したリアルタイム音声出力
- **Polyphonic Support**: 複数の同時音声再生
- **Custom Note Duration**: 各音の正確な持続時間指定
- **Interactive Command-line Interface**: 日本語ローカライズされた制御

## 🎮 インタラクティブ制御

### 基本音声制御（継続再生）
- **`c` + Enter**: 中央のC音 (60)
- **`d` + Enter**: D音 (62)
- **`e` + Enter**: E音 (64)
- **`f` + Enter**: F音 (65)
- **`g` + Enter**: G音 (67)
- **`a` + Enter**: A音 (69)
- **`b` + Enter**: B音 (71)
- **`s` + Enter**: 全ての音を停止
- **`q` + Enter**: 終了

### カスタム持続時間制御
- **`C <秒数>`**: 中央のC音を指定時間再生（例：`C 2.5`）
- **`D <秒数>`**: D音を指定時間再生（例：`D 1.8`）
- **`E <秒数>`**: E音を指定時間再生（例：`E 1.8`）
- **`F <秒数>`**: F音を指定時間再生（例：`F 0.3`）
- **`G <秒数>`**: G音を指定時間再生（例：`G 0.3`）
- **`A <秒数>`**: A音を指定時間再生（例：`A 4.2`）
- **`B <秒数>`**: B音を指定時間再生（例：`B 4.2`）
- **`H <秒数>`**: 高いC音を指定時間再生（例：`H 4.2`）
- **`CHORD <秒数>`**: C-E-G和音を指定時間再生（例：`CHORD 5.0`）
- **`SCALE <秒数>`**: C-D-E-F-G-A-B-C音階を指定時間再生（例：`SCALE 8.0`）

### 音色調整制御
- **`1-9` + Enter**: ブレンド比率（1=Additive、9=FM）
- **`env` + Enter**: エンベロープ設定調整
- **`filter` + Enter**: フィルター設定調整
- **`p` + Enter**: アクティブな音声を表示

## 🎼 音階

シンセサイザーは完全な1オクターブをサポートします：
```
C (60) - D (62) - E (64) - F (65) - G (67) - A (69) - B (71)
```

## 🚀 セットアップ

### 前提条件
- Rust（最新の安定版）
- Visual Studio Build Tools（Windows）

### インストール
1. リポジトリをクローン：
```bash
git clone <repository-url>
cd synthesizer
```

2. ビルドと実行：
```bash
cargo run
```

### 使用例

#### 音階の演奏
```
> c    ← C音開始
> d    ← D音追加
> e    ← E音追加
> f    ← F音追加
> g    ← G音追加
> a    ← A音追加
> b    ← B音追加
```

#### カスタム持続時間
```
> C 2.5    ← C音を2.5秒間再生
> D 1.8    ← D音を1.8秒間再生
> CHORD 5.0 ← C-E-G和音を5秒間再生
> SCALE 8.0 ← 完全な音階を8秒間再生
```

#### 音色調整
```
> 1        ← 純粋なAdditive合成
> 9        ← 純粋なFM合成
> 5        ← 50/50ブレンド
> env      ← エンベロープ調整
> filter   ← フィルター調整
```

## 🏗️ アーキテクチャ

- **`src/main.rs`**: インタラクティブコマンドラインインターフェース
- **`src/synth.rs`**: ポリフォニック音声管理を備えたメインシンセサイザー
- **`src/engine.rs`**: AdditiveとFM合成エンジン
- **`src/audio.rs`**: cpalを使用したリアルタイム音声出力

## 🎛️ 技術詳細

### ポリフォニック音声管理
- 各音は個別の`Voice`インスタンスとして管理
- 指定時間後の自動ノートオフ
- リアルタイム音声割り当てと解放

### 合成エンジン
- **Additive**: 個別振幅制御を備えた64個の倍音
- **FM**: 周波数比とフィードバックを備えた6個のオペレーター
- **Blending**: エンジン間のスムーズなクロスフェード

### 音声処理
- 48kHzでのリアルタイムサンプル生成
- 複数の音声形式をサポート
- 低レイテンシー音声出力

## 🔧 開発

### ビルド
```bash
cargo build
```

### テスト実行
```bash
cargo test
```

### コード構造
```
src/
├── main.rs      # エントリーポイントとCLI
├── synth.rs     # シンセサイザーコア
├── engine.rs    # 合成エンジン
└── audio.rs     # 音声出力
```

## 🎵 今後の拡張予定

- MIDI入力サポート
- GUIインターフェース
- 音声エフェクト（リバーブ、ディレイ、コーラス）
- プリセット管理
- スコア再生
- MIDIファイルサポート

## 📝 ライセンス

このプロジェクトはオープンソースで、MITライセンスの下で利用可能です。
